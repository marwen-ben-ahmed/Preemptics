| User Story                                             | Detailed Goal                                                                  | Technical Details                                                                                                                                                                                                                                                                      | Acceptance Criteria & Test Cases                                                                                                                                                                                 | Service Type / Processing Type   |
| ------------------------------------------------------ | ------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------- |
| **US-001: CTI Ingestion - Multi-source**               | Ingest CTI from multiple sources and store as raw STIX2.1 objects.             | - Python microservice using Celery for async ingestion.<br>- Supports STIX2.1 JSON, TAXII feeds, API feeds, CSV/email.<br>- Store all raw CTI in Azure Blob Storage or PostgreSQL JSONB.<br>- Track ingestion status and errors.                                                       | - Test: Feed added → STIX2.1 objects ingested successfully.<br>- Test: Invalid STIX2.1 → Error logged, ingestion continues.<br>- Test: Duplicates → Deduplicated based on STIX2.1 `id`.                          | Rule-based / Standard Processing |
| **US-002: CTI Validation**                             | Validate ingested raw STIX2.1 objects for schema correctness.                  | - Python service validates each STIX2.1 object against official STIX2.1 schema.<br>- Log validation errors and mark objects invalid.<br>- Store only valid STIX2.1 objects in central storage.                                                                                         | - Test: Valid STIX2.1 → Stored successfully.<br>- Test: Malformed STIX2.1 → Logged error, not stored.<br>- Test: Validation status reflected in DB/API.                                                          | Rule-based / Standard Processing |
| **US-003: MITRE ATT\&CK Mapping**                      | Map **raw STIX2.1 objects** to MITRE ATT\&CK TTPs.                             | - Python microservice consumes raw STIX2.1 objects from central storage.<br>- Parse `pattern`, `labels`, `type`, and `id`.<br>- Map to TTPs using rules + AI-assisted fuzzy matching (Azure OpenAI).<br>- Store mapping in PostgreSQL: `cti_ttp_mappings` (`indicator_id` → `TTP(s)`). | - Test: Known STIX indicator → Correct TTP mapping.<br>- Test: New/unmapped indicator → AI suggests candidate TTPs.<br>- Test: Multiple STIX objects → Batch mapping works.<br>- Test: Mapping reflected in API. | Hybrid: Rules + RAG Suggestions  |
| **US-004: KESTREL Query Integration**                  | Execute hunting queries on raw STIX2.1 CTI data.                               | - Python service parses STIX2.1 objects to evaluate queries.<br>- KESTREL query engine asynchronously executed via Celery.<br>- Log query execution and results.                                                                                                                       | - Test: Query returns expected indicators.<br>- Test: Malformed query → Error returned and logged.<br>- Test: Batch queries → Results aggregated correctly.                                                      | Rule-based / KESTREL Engine      |
| **US-005: Hypothesis Management**                      | Analysts define, store, and track hunting hypotheses based on raw STIX2.1 CTI. | - PostgreSQL table: `hypotheses` (id, analyst\_id, description, status, related\_stix\_ids).<br>- CRUD API via DRF.<br>- AI agent suggests hypotheses based on new STIX2.1 objects.                                                                                                    | - Test: Analyst creates hypothesis → Stored and retrievable.<br>- Test: AI suggestion → Analyst can accept/reject.<br>- Test: Deletion only allowed for owner/admin.                                             | AI Agent Suggestions             |
| **US-006: Playbook Engine - Automated/Semi-Automated** | Execute playbooks triggered by raw STIX2.1 events or analyst actions.          | - Playbooks defined as YAML/JSON templates.<br>- Python service executes steps: enrichment, alerting, notifications.<br>- AI can suggest next steps.<br>- Log all runs in `playbook_runs` table.                                                                                       | - Test: Trigger event → Correct playbook executed.<br>- Test: Semi-automated steps → Require analyst approval.<br>- Test: Audit logs accurate.                                                                   | Rule-based / AI Agent Assisted   |
| **US-007: API Layer for Frontend**                     | Expose all backend data securely to frontend.                                  | - Django REST Framework APIs:<br>  - `/api/cti/` → Access raw STIX2.1 objects<br>  - `/api/ttp/` → TTP mappings<br>  - `/api/hypotheses/` → CRUD<br>  - `/api/playbooks/` → Run & track<br>- JWT authentication, role-based access (junior/senior).                                    | - Test: Authorized user → Correct data returned.<br>- Test: Unauthorized → 403 forbidden.<br>- Test: Data modifications reflected in DB/API.                                                                     | Standard API Layer               |
| **US-008: AI Agent Service (RAG)**                     | Provide enrichment, hypotheses, and insights from raw STIX2.1 objects.         | - Python microservice with Azure OpenAI embeddings & LLM.<br>- Vector DB for CTI embeddings.<br>- Async Celery tasks for processing.<br>- Suggestions logged with confidence score.                                                                                                    | - Test: Analyst query → Relevant enriched info returned.<br>- Test: Similar STIX2.1 objects → AI suggests linking.<br>- Test: Logs show AI confidence & output.                                                  | RAG + AI Agent                   |
| **US-009: Security & Access Control**                  | Ensure backend security for SOC operations.                                    | - Role-based access (junior/senior/admin).<br>- OAuth2/JWT authentication.<br>- Audit logging for all actions.<br>- Secure communication (HTTPS/TLS).                                                                                                                                  | - Test: Unauthorized access blocked.<br>- Test: All modifications logged.<br>- Test: Data transmission encrypted.                                                                                                | Standard Security Rules          |
| **US-010: Logging & Monitoring**                       | Centralized logging & monitoring of backend services.                          | - Azure Monitor / Application Insights.<br>- Logs for Celery, API, AI services.<br>- Alerts for ingestion failures or anomalies.                                                                                                                                                       | - Test: Simulate ingestion failure → Alert generated.<br>- Test: API errors logged with details.<br>- Test: Monitoring dashboard shows live metrics.                                                             | Standard Monitoring / Rules      |
| **US-011: Database Backup & Recovery**                 | Ensure CTI data and mappings are safely stored.                                | - PostgreSQL automated backups.<br>- Blob Storage snapshots for raw STIX2.1.<br>- Test recovery procedures.                                                                                                                                                                            | - Test: Daily backup created.<br>- Test: Restore from backup → Data integrity verified.                                                                                                                          | Standard Rules / Ops             |
| **US-012: Dockerized Deployment**                      | Run backend in containerized environment.                                      | - Dockerfile for backend microservices.<br>- Docker Compose for dev (PostgreSQL, Redis, Celery, backend).<br>- CI/CD pipeline for Azure deployment.                                                                                                                                    | - Test: Docker Compose up → All services start.<br>- Test: Backend accessible via API.<br>- Test: CI/CD deploys latest version to Azure.                                                                         | Standard Ops / Deployment        |
